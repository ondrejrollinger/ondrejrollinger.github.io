<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IDS Lab Kanban Tracker | ondrejrollinger.github.io</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      background-color: #0a0e14;
      color: #b3b1ad;
      min-height: 100vh;
      overflow-x: auto;
    }

    /* Scanline overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.07) 2px,
        rgba(0, 0, 0, 0.07) 4px
      );
      z-index: 9999;
    }

    #root {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── Header ── */
    .header {
      border-bottom: 1px solid #1e2530;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .header-title {
      color: #00ff9f;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      white-space: nowrap;
    }

    .header-title span {
      color: #4d5566;
    }

    .header-divider {
      width: 1px;
      height: 20px;
      background: #1e2530;
      flex-shrink: 0;
    }

    .filters {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .filter-label {
      font-size: 0.7rem;
      color: #4d5566;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .filter-btn {
      font-family: inherit;
      font-size: 0.72rem;
      padding: 3px 10px;
      border-radius: 3px;
      border: 1px solid transparent;
      cursor: pointer;
      background: transparent;
      transition: all 0.15s;
      letter-spacing: 0.03em;
    }

    .filter-btn.active {
      border-color: currentColor;
    }

    .filter-btn:not(.active) {
      opacity: 0.45;
    }

    .filter-btn:not(.active):hover {
      opacity: 0.75;
    }

    .add-btn {
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 6px 14px;
      background: transparent;
      border: 1px solid #00ff9f;
      color: #00ff9f;
      border-radius: 3px;
      cursor: pointer;
      letter-spacing: 0.05em;
      transition: background 0.15s, color 0.15s;
      margin-left: auto;
      white-space: nowrap;
    }

    .add-btn:hover {
      background: #00ff9f;
      color: #0a0e14;
    }

    /* ── Board ── */
    .board {
      display: flex;
      gap: 16px;
      padding: 20px 24px;
      flex: 1;
      overflow-x: auto;
      align-items: flex-start;
    }

    .column {
      flex: 1;
      min-width: 230px;
      max-width: 320px;
      background: #0d1117;
      border: 1px solid #1e2530;
      border-radius: 4px;
      display: flex;
      flex-direction: column;
    }

    .column.drag-over {
      border-color: #38bdf8;
      background: #0d1620;
    }

    .column-header {
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid #1e2530;
    }

    .column-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .column-title {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .column-count {
      margin-left: auto;
      font-size: 0.65rem;
      color: #4d5566;
      background: #1a1f28;
      padding: 1px 6px;
      border-radius: 10px;
    }

    .column-body {
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 60px;
    }

    /* ── Card ── */
    .card {
      background: #0f1318;
      border: 1px solid #1e2530;
      border-radius: 3px;
      padding: 10px 12px;
      cursor: grab;
      position: relative;
      transition: border-color 0.15s, transform 0.1s;
    }

    .card:hover {
      border-color: #2e3a4a;
    }

    .card:active {
      cursor: grabbing;
    }

    .card.dragging {
      opacity: 0.5;
      transform: rotate(1.5deg);
    }

    .card-top {
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .card-symbol {
      font-size: 0.75rem;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .card-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: #e6e1cf;
      line-height: 1.3;
      flex: 1;
    }

    .card-note {
      font-size: 0.68rem;
      color: #4d5566;
      margin-top: 6px;
      padding-left: 20px;
      line-height: 1.4;
      font-style: italic;
    }

    .card-actions {
      position: absolute;
      top: 6px;
      right: 6px;
      display: none;
      gap: 4px;
    }

    .card:hover .card-actions {
      display: flex;
    }

    .card-action-btn {
      font-family: inherit;
      font-size: 0.7rem;
      padding: 2px 5px;
      background: #1a1f28;
      border: 1px solid #2e3a4a;
      color: #b3b1ad;
      border-radius: 2px;
      cursor: pointer;
      transition: background 0.1s, color 0.1s;
    }

    .card-action-btn:hover {
      background: #2e3a4a;
      color: #e6e1cf;
    }

    .card-action-btn.delete:hover {
      background: #3a1a1a;
      color: #ff6b6b;
      border-color: #ff6b6b;
    }

    /* Quick-move buttons */
    .quick-moves {
      display: none;
      gap: 4px;
      margin-top: 8px;
      padding-left: 20px;
      flex-wrap: wrap;
    }

    .card:hover .quick-moves {
      display: flex;
    }

    .quick-move-btn {
      font-family: inherit;
      font-size: 0.62rem;
      padding: 2px 6px;
      background: transparent;
      border: 1px solid #2e3a4a;
      color: #4d5566;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.1s;
      white-space: nowrap;
    }

    .quick-move-btn:hover {
      border-color: #38bdf8;
      color: #38bdf8;
    }

    /* ── Modal ── */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(10, 14, 20, 0.85);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal {
      background: #0d1117;
      border: 1px solid #2e3a4a;
      border-radius: 5px;
      padding: 24px;
      width: 100%;
      max-width: 440px;
    }

    .modal-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: #00ff9f;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 0.68rem;
      color: #4d5566;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      font-family: inherit;
      font-size: 0.8rem;
      width: 100%;
      background: #0a0e14;
      border: 1px solid #2e3a4a;
      color: #e6e1cf;
      border-radius: 3px;
      padding: 8px 10px;
      outline: none;
      transition: border-color 0.15s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: #38bdf8;
    }

    .form-textarea {
      resize: vertical;
      min-height: 60px;
    }

    .form-select option {
      background: #0d1117;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn-cancel {
      font-family: inherit;
      font-size: 0.75rem;
      padding: 7px 16px;
      background: transparent;
      border: 1px solid #2e3a4a;
      color: #4d5566;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-cancel:hover {
      border-color: #4d5566;
      color: #b3b1ad;
    }

    .btn-save {
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 7px 16px;
      background: transparent;
      border: 1px solid #00ff9f;
      color: #00ff9f;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-save:hover {
      background: #00ff9f;
      color: #0a0e14;
    }

    /* ── Empty state ── */
    .empty-state {
      font-size: 0.68rem;
      color: #2e3a4a;
      text-align: center;
      padding: 16px 8px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ── Constants ──────────────────────────────────────────────────────────
    const STORAGE_KEY = 'ondrej-lab-kanban-v1';

    const COLUMNS = ['Backlog', 'Planned', 'In Progress', 'Done'];

    const COLUMN_COLORS = {
      'Backlog':     '#4d5566',
      'Planned':     '#38bdf8',
      'In Progress': '#f59e0b',
      'Done':        '#00ff9f',
    };

    const CATEGORIES = {
      'Lab Dev':       { color: '#00ff9f', symbol: '●' },
      'Theory Post':   { color: '#38bdf8', symbol: '◆' },
      'Practical Post':{ color: '#f59e0b', symbol: '▲' },
      'Future Idea':   { color: '#a78bfa', symbol: '★' },
    };

    const SEED_CARDS = [
      { id: 's1', title: 'Port Scan Detection',        category: 'Lab Dev',        column: 'In Progress', note: 'Zeek script in progress' },
      { id: 's2', title: 'DNS Tunneling Detection',    category: 'Theory Post',    column: 'Planned',     note: '' },
      { id: 's3', title: 'TLS Certificate Analysis',   category: 'Theory Post',    column: 'Backlog',     note: '' },
      { id: 's4', title: 'VLAN Segmentation Setup',    category: 'Practical Post', column: 'Done',        note: 'Documented in lab PDF' },
      { id: 's5', title: 'Inline IPS Mode',            category: 'Future Idea',    column: 'Backlog',     note: 'Suricata blocking mode' },
      { id: 's6', title: 'IoT Device Behavior Profiling', category: 'Lab Dev',     column: 'Planned',     note: '' },
    ];

    // ── Helpers ────────────────────────────────────────────────────────────
    const genId = () => `c${Date.now()}-${Math.random().toString(36).slice(2, 7)}`;

    const loadCards = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) return JSON.parse(raw);
      } catch (_) {}
      return SEED_CARDS;
    };

    const saveCards = (cards) => {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(cards)); } catch (_) {}
    };

    // ── CardItem component ─────────────────────────────────────────────────
    function CardItem({ card, onEdit, onDelete, onMove, isDragging, onDragStart, onDragEnd }) {
      const cat = CATEGORIES[card.category] || CATEGORIES['Lab Dev'];
      const otherCols = COLUMNS.filter(c => c !== card.column);

      return (
        <div
          className={`card${isDragging ? ' dragging' : ''}`}
          draggable
          onDragStart={onDragStart}
          onDragEnd={onDragEnd}
          style={{ borderLeft: `3px solid ${cat.color}` }}
        >
          <div className="card-top">
            <span className="card-symbol" style={{ color: cat.color }}>{cat.symbol}</span>
            <span className="card-title">{card.title}</span>
          </div>
          {card.note && <div className="card-note">{card.note}</div>}

          {/* Quick-move buttons */}
          <div className="quick-moves">
            {otherCols.map(col => (
              <button
                key={col}
                className="quick-move-btn"
                onClick={() => onMove(card.id, col)}
              >
                → {col}
              </button>
            ))}
          </div>

          {/* Action buttons */}
          <div className="card-actions">
            <button className="card-action-btn" title="Edit" onClick={() => onEdit(card)}>✎</button>
            <button className="card-action-btn delete" title="Delete" onClick={() => onDelete(card.id)}>✕</button>
          </div>
        </div>
      );
    }

    // ── Modal component ────────────────────────────────────────────────────
    function CardModal({ initial, onSave, onClose }) {
      const [form, setForm] = useState({
        title:    initial?.title    ?? '',
        category: initial?.category ?? 'Lab Dev',
        column:   initial?.column   ?? 'Backlog',
        note:     initial?.note     ?? '',
      });

      const set = (k, v) => setForm(f => ({ ...f, [k]: v }));

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!form.title.trim()) return;
        onSave(form);
      };

      return (
        <div className="modal-backdrop" onClick={(e) => { if (e.target === e.currentTarget) onClose(); }}>
          <div className="modal">
            <div className="modal-title">{initial ? '✎ Edit Card' : '+ New Card'}</div>
            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label className="form-label">Title *</label>
                <input
                  className="form-input"
                  type="text"
                  value={form.title}
                  onChange={e => set('title', e.target.value)}
                  placeholder="Card title"
                  autoFocus
                  required
                />
              </div>

              <div className="form-group">
                <label className="form-label">Category</label>
                <select className="form-select" value={form.category} onChange={e => set('category', e.target.value)}>
                  {Object.keys(CATEGORIES).map(c => (
                    <option key={c} value={c}>{CATEGORIES[c].symbol} {c}</option>
                  ))}
                </select>
              </div>

              <div className="form-group">
                <label className="form-label">Column</label>
                <select className="form-select" value={form.column} onChange={e => set('column', e.target.value)}>
                  {COLUMNS.map(c => <option key={c} value={c}>{c}</option>)}
                </select>
              </div>

              <div className="form-group">
                <label className="form-label">Note (optional)</label>
                <textarea
                  className="form-textarea"
                  value={form.note}
                  onChange={e => set('note', e.target.value)}
                  placeholder="Short note…"
                />
              </div>

              <div className="modal-actions">
                <button type="button" className="btn-cancel" onClick={onClose}>Cancel</button>
                <button type="submit" className="btn-save">Save</button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // ── Main App ───────────────────────────────────────────────────────────
    function App() {
      const [cards, setCards] = useState(loadCards);
      const [filter, setFilter] = useState(null); // null = show all
      const [modal, setModal] = useState(null);   // null | 'new' | cardObject
      const dragId = useRef(null);
      const [dragOverCol, setDragOverCol] = useState(null);

      // Persist on change
      useEffect(() => { saveCards(cards); }, [cards]);

      const addCard = (form) => {
        setCards(cs => [...cs, { id: genId(), ...form }]);
        setModal(null);
      };

      const editCard = (form) => {
        setCards(cs => cs.map(c => c.id === modal.id ? { ...c, ...form } : c));
        setModal(null);
      };

      const deleteCard = (id) => {
        if (!window.confirm('Delete this card?')) return;
        setCards(cs => cs.filter(c => c.id !== id));
      };

      const moveCard = (id, targetCol) => {
        setCards(cs => cs.map(c => c.id === id ? { ...c, column: targetCol } : c));
      };

      // Drag handlers
      const handleDragStart = (id) => { dragId.current = id; };
      const handleDragEnd   = () => { dragId.current = null; setDragOverCol(null); };

      const handleDrop = (col) => {
        if (dragId.current) moveCard(dragId.current, col);
        setDragOverCol(null);
      };

      const visibleCards = filter ? cards.filter(c => c.category === filter) : cards;

      return (
        <>
          {/* Header */}
          <header className="header">
            <div className="header-title">
              <span>▶ ondrej@lab</span> ~/projects/ids-lab
            </div>
            <div className="header-divider" />
            <div className="filters">
              <span className="filter-label">Filter:</span>
              {Object.entries(CATEGORIES).map(([name, { color, symbol }]) => (
                <button
                  key={name}
                  className={`filter-btn${filter === name ? ' active' : ''}`}
                  style={{ color }}
                  onClick={() => setFilter(filter === name ? null : name)}
                >
                  {symbol} {name}
                </button>
              ))}
            </div>
            <button className="add-btn" onClick={() => setModal('new')}>+ NEW ITEM</button>
          </header>

          {/* Board */}
          <div className="board">
            {COLUMNS.map(col => {
              const colCards = visibleCards.filter(c => c.column === col);
              const allCount = cards.filter(c => c.column === col).length;
              return (
                <div
                  key={col}
                  className={`column${dragOverCol === col ? ' drag-over' : ''}`}
                  onDragOver={e => { e.preventDefault(); setDragOverCol(col); }}
                  onDragLeave={() => setDragOverCol(null)}
                  onDrop={() => handleDrop(col)}
                >
                  <div className="column-header">
                    <div className="column-dot" style={{ background: COLUMN_COLORS[col] }} />
                    <span className="column-title" style={{ color: COLUMN_COLORS[col] }}>{col}</span>
                    <span className="column-count">{allCount}</span>
                  </div>
                  <div className="column-body">
                    {colCards.length === 0 && (
                      <div className="empty-state">drop here</div>
                    )}
                    {colCards.map(card => (
                      <CardItem
                        key={card.id}
                        card={card}
                        isDragging={dragId.current === card.id}
                        onEdit={setModal}
                        onDelete={deleteCard}
                        onMove={moveCard}
                        onDragStart={() => handleDragStart(card.id)}
                        onDragEnd={handleDragEnd}
                      />
                    ))}
                  </div>
                </div>
              );
            })}
          </div>

          {/* Modal */}
          {modal === 'new' && (
            <CardModal onSave={addCard} onClose={() => setModal(null)} />
          )}
          {modal && modal !== 'new' && (
            <CardModal initial={modal} onSave={editCard} onClose={() => setModal(null)} />
          )}
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
